<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>bikelanes-map</title>
        <link rel="stylesheet" href="src/leaflet.css">
        <link rel="stylesheet" href="src/css/bootstrap.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.PolylineMeasure.css">
        <link rel="stylesheet" href="src/plugins/easy-button.css">
        <link rel="stylesheet" href="src/plugins/L.Control.Sidebar.css">
        <script src="src/leaflet.js"></script>
        <script src="src/jquery-3.2.0.min.js"></script>
        <script src="src/plugins/leaflet.ajax.min.js"></script>
        <script src="src/leaflet-providers.js"></script>
        <script src="src/plugins/Leaflet.PolylineMeasure.js"></script>
        <script src="src/plugins/easy-button.js"></script>
        <link rel="stylesheet" href="src/plugins/L.Control.Sidebar.js">
    </head>
<!-- TITLE STYLING -->
        <style>
            /* body {margin:0; padding:0;} */
            #mapdiv {height:100vh}
            #map-title {position: relative; margin-top: 5px; margin-bottom: 5px; margin-left: relative;  
                         float: center; background: whitesmoke; border: 2px solid rgba(0,0,0,0.2); padding: 5px 5px; 
                         font-family: Helvetica; font-weight: bold; font-size: 24px; z-index: 800;};
        </style>
<!-- SIDEBAR CONTENT -->
    <body>
        <div id="side-bar" class="col-md-3">
            <div id="map-title" >Bayanihan II bike lanes</div>
            <button id='btnLocate' class='btn btn-primary btn-block'>Zoom to your location</button>
            <button id='btnMManila' class='btn btn-primary btn-block'>Zoom to Metro Manila</button>
            <button id='btnMCebu' class='btn btn-primary btn-block'>Zoom to Metro Cebu</button>
            <button id='btnMDavao' class='btn btn-primary btn-block'>Zoom to Metro Davao</button>
            <h4>Mouse location: <span id='mouse-location'></span></h4>
        </div>
        <div id="mapdiv" class="col-md-9"></div>
        <script>
            var mymap;
            var lyrCarto; 
            var lyrOSM;
            var mrkCurrentLocation
            var lyrToner;
            var lyrImagery
            var lyrBikeLanesMManila_ba2;    // BAYANIHAN II METRO MANILA
            var lyrBikeLanesMCebu_ba2;      // BAYANIHAN II METRO CEBU
            var lyrBikeLanesMDavao_ba2;     // BAYANIHAN II METRO DAVAO
            var lyrBikeLanesSNCR_2021;      // 2021 SOUTH NCR EXPANSION
            var lyrBikeLanesQC;             // QUEZON CITY LGU
            var lyrUsblBikeLanes            // MAPPED USABLE BIKE LANES
            var ctlLayers;
            var ctlMeasure;
            var ctlSidebar
            var ctlEasybutton;
            var objBasemaps;
            var objOverlays;

            $(document).ready(function(){    
// MAP INITIALIZATION     
                mymap = L.map('mapdiv', {center:[14.560, 121.027], zoom:11});
// POP-UP W/ COORDINATES AND DATE
                mymap.on('contextmenu', function(e) {
                    var dtCurrentTime = new Date();
                    L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString()+"<br>"+dtCurrentTime.toString());
                });

                function LatLngToArrayString(ll) {
                    console.log(ll);
                    return ""+ll.lat.toFixed(3)+", "+ll.lng.toFixed(3)+"";
                }

// LOCATE POSITION BUTTON
                mymap.on('locationfound', function(e) {
                    console.log(e);
                    if (mrkCurrentLocation) {
                        mrkCurrentLocation.remove();
                    }
                    mrkCurrentLocation = L.circle(e.latlng, {radius:e.accuracy/0.5}).addTo(mymap);
                    mymap.setView(e.latlng, 16);
                });
                
                mymap.on('locationerror', function(e) {
                    console.log(e);
                    alert("Location was not found");
                })
                
                $("#btnLocate").click(function(){
                    mymap.locate();
                });
// ZOOM TO AREA
                $("#btnMManila").click(function(){
                    mymap.setView([14.560, 121.027], 11);
                })

                $("#btnMCebu").click(function(){
                    mymap.setView([10.298, 123.925], 12);
                })

                $("#btnMDavao").click(function(){
                    mymap.setView([7.052, 125.560], 13);
                })

// LIVE COORDINATES ON SIDEBAR
                mymap.on('mousemove', function(e){
                    $("#mouse-location").html(LatLngToArrayString(e.latlng));
                });
                
// MEASURE FUNCTION
                ctlMeasure = L.control.polylineMeasure().addTo(mymap);
// BASEMAPS
                lyrCarto = L.tileLayer.provider('CartoDB.Positron', 
                                                {attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors, &copy;<a href="https://carto.com/attribution">CARTO</a>',
                                                 subdomains: 'abcd',
	                                             maxZoom: 19});
                lyrCarto.addTo(mymap);
                lyrOSM = L.tileLayer.provider('OpenStreetMap.Mapnik', 
                                                {attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                                                 maxZoom: 19,});
                lyrToner = L.tileLayer.provider('Stamen.TonerLite', 
                                                {attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	                                             subdomains: 'abcd',
                                                 minZoom: 0,
                                                 maxZoom: 20,
                                                 ext: 'png'});
                lyrImagery = L.tileLayer.provider('Esri.WorldImagery',
                                                  {attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'});
// VECTOR LAYERS
                lyrBikeLanesMManila_ba2 = L.geoJSON.ajax('data/ba2_bikelanes_ncr.geojson', {style:ba2ncrStyle}).addTo(mymap);
                lyrBikeLanesMCebu_ba2 = L.geoJSON.ajax('data/ba2_bikelanes_metrocebu.geojson', {style:ba2mcebuStyle}).addTo(mymap);
                lyrBikeLanesMDavao_ba2 = L.geoJSON.ajax('data/ba2_bikelanes_metrodavao.geojson', {style:ba2mdavaoStyle}).addTo(mymap);
                lyrBikeLanesMManila_ba2 = L.geoJSON.ajax('data/ba2_bikelanes_ncr.geojson', {style:ba2ncrStyle}).addTo(mymap);
                lyrBikeLanesSNCR_2021 = L.geoJSON.ajax('data/2021_bikelanes_south_ncr.geojson', {style:sncrStyle}).addTo(mymap);
                lyrBikeLanesQC = L.geoJSON.ajax('data/qc_bikelanes_ncr.geojson', {style:qcblStyle}).addTo(mymap);          
                lyrUsblBikeLanes = L.geoJSON.ajax('data/usable_bikelanes_30April2021.geojson', {style:usblStyle}).addTo(mymap);
// LAYER CONTROL
// // BASEMAPS     
                objBasemaps = {
                    "Carto Positron": lyrCarto,
                    "OpenStreetMap": lyrOSM,
                    "Stamen Toner Lite": lyrToner,
                    "ESRI Imagery": lyrImagery
                }
// // VECTOR LAYERS
                objOverlays = {
                    "Usable bike lanes as of 30 April": lyrUsblBikeLanes,
                    "Bayanihan II NCR": lyrBikeLanesMManila_ba2,
                    "Bayanihan II Metro Cebu": lyrBikeLanesMCebu_ba2,
                    "Bayanihan II Metro Davao": lyrBikeLanesMDavao_ba2,
                    "Quezon City LGU": lyrBikeLanesQC,
                    "2021 South NCR": lyrBikeLanesSNCR_2021
                    
                }

                ctlLayers = L.control.layers(objBasemaps, objOverlays).addTo(mymap);
// LAYER STYLING
                function ba2ncrStyle(json) {
                    var att = json.properties;
                    switch (att.type) {
                        case 'Circumferential':
                            return {color: 'black', weight: 5.5};
                            break;
                        case 'Radial':
                            return {color: 'black', weight: 4.5};
                            break;
                        default: 
                            return {color: 'black', weight: 4};
                    } 
                }

                function ba2mcebuStyle(json) {
                    return {color:'black', weight: 4}
                }

                function ba2mdavaoStyle(json) {
                    return {color:'black', weight: 4}
                }

                function sncrStyle(json) {
                    return {
                        color: 'blue',
                        weight: 4
                    }};

                function qcblStyle(json) {
                    return {
                        color: 'green',
                        weight: 4   
                    }};

                function usblStyle (json) {
                    var att = json.properties;
                    switch (att.Name) {
                        case 'Usable':
                            return {color: 'yellow'}
                            break;
                        case 'Moderately Usable':
                            return {color: 'yellow', 
                                    dashArray: "5,5"};
                            break;
                        default:
                            return {color: 'orange', 
                                    dashArray: "4,4", 
                                    weight: 0.85}
                    }
                }

            });
            
        </script>
    </body>
</html>